name: Multiple Daily Commits with Telegram

on:
  schedule:
    # 4 –∑–∞–ø—É—Å–∫–∞ –≤ –¥–µ–Ω—å –≤ —Ä–∞–∑–Ω–æ–µ –≤—Ä–µ–º—è (UTC –≤—Ä–µ–º—è)
    - cron: '0 5 * * *'  # 08:00 –ú–°–ö - —É—Ç—Ä–µ–Ω–Ω–∏–µ –∫–æ–º–º–∏—Ç—ã
    - cron: '0 8 * * *'  # 11:00 –ú–°–ö - –¥–Ω–µ–≤–Ω—ã–µ –∫–æ–º–º–∏—Ç—ã  
    - cron: '0 11 * * *' # 14:00 –ú–°–ö - –ø–æ—Å–ª–µ–æ–±–µ–¥–µ–Ω–Ω—ã–µ
    - cron: '0 14 * * *' # 17:00 –ú–°–ö - –≤–µ—á–µ—Ä–Ω–∏–µ
  workflow_dispatch:

jobs:
  commit-session:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        fetch-depth: 0
    
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Generate multiple commits
      id: generate_commits
      env:
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      run: |
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–µ—Å—Å–∏—é –ø–æ –≤—Ä–µ–º–µ–Ω–∏ UTC
        CURRENT_HOUR=$(date -u +%H)
        case $CURRENT_HOUR in
          "05") SESSION="üåÖ –£—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Å—Å–∏—è (08:00 –ú–°–ö)" ;;
          "08") SESSION="‚òÄÔ∏è –î–Ω–µ–≤–Ω–∞—è —Å–µ—Å—Å–∏—è (11:00 –ú–°–ö)" ;;
          "11") SESSION="üåá –ü–æ—Å–ª–µ–æ–±–µ–¥–µ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è (14:00 –ú–°–ö)" ;;
          "14") SESSION="üåô –í–µ—á–µ—Ä–Ω—è—è —Å–µ—Å—Å–∏—è (17:00 –ú–°–ö)" ;;
          *) SESSION="‚ö° –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —Å–µ—Å—Å–∏—è" ;;
        esac
        
        # –°–ª—É—á–∞–π–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–º–∏—Ç–æ–≤ –æ—Ç 2 –¥–æ 4
        COMMIT_COUNT=$((2 + RANDOM % 3))
        echo "commit_count=$COMMIT_COUNT" >> $GITHUB_OUTPUT
        echo "session_name=$SESSION" >> $GITHUB_OUTPUT
        
        echo "–ù–∞—á–∏–Ω–∞–µ–º $SESSION"
        echo "–°–æ–∑–¥–∞–µ–º $COMMIT_COUNT –∫–æ–º–º–∏—Ç–æ–≤..."
        
        # –ú–∞—Å—Å–∏–≤ —Ñ–∞–π–ª–æ–≤ –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
        FILES=("src/main.py" "docs/README.md" "config/settings.json" "tests/test_api.py" "package.json")
        
        for i in $(seq 1 $COMMIT_COUNT); do
          echo "üîÑ –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞ $i –∏–∑ $COMMIT_COUNT..."
          
          # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Ñ–∞–π–ª
          FILE_INDEX=$((RANDOM % ${#FILES[@]}))
          FILE=${FILES[$FILE_INDEX]}
          
          # –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
          mkdir -p $(dirname "$FILE")
          
          # –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª —Å –≤—Ä–µ–º–µ–Ω–µ–º
          echo "# Update $(date -u +'%Y-%m-%d %H:%M:%S UTC')" >> $FILE
          echo "# Commit $i/$COMMIT_COUNT in $SESSION" >> $FILE
          echo "last_updated: $(date +%s)" >> $FILE
          echo "" >> $FILE
          
          # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ git
          git config --local user.email "github-actions[bot]@users.noreply.github.com" 
          git config --local user.name "github-actions[bot]"
          
          # –ö–æ–º–º–∏—Ç–∏–º
          git add $FILE
          git commit -m "üìù $SESSION - –ö–æ–º–º–∏—Ç $i/$COMMIT_COUNT"
          
          echo "‚úÖ –ö–æ–º–º–∏—Ç $i —Å–æ–∑–¥–∞–Ω (—Ñ–∞–π–ª: $FILE)"
          
          # –ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞ –º–µ–∂–¥—É –∫–æ–º–º–∏—Ç–∞–º–∏ (1-5 —Å–µ–∫—É–Ω–¥)
          sleep $((1 + RANDOM % 5))
        done
        
        # –ü—É—à–∏–º –≤—Å–µ –∫–æ–º–º–∏—Ç—ã
        git push
        echo "‚úÖ –í—Å–µ $COMMIT_COUNT –∫–æ–º–º–∏—Ç–æ–≤ –∑–∞–ø—É—à–µ–Ω—ã"
    
    - name: Send Telegram session notification
      if: success()
      env:
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      run: |
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —ç–º–æ–¥–∑–∏ –¥–ª—è —Å–µ—Å—Å–∏–∏
        CURRENT_HOUR=$(date -u +%H)
        case $CURRENT_HOUR in
          "05") EMOJI="üåÖ" ;;
          "08") EMOJI="‚òÄÔ∏è" ;;
          "11") EMOJI="üåá" ;;
          "14") EMOJI="üåô" ;;
          *) EMOJI="‚ö°" ;;
        esac
        
        MESSAGE="$EMOJI <b>${{ steps.generate_commits.outputs.session_name }}</b>%0A%0A"
        MESSAGE+="üìä <b>–°–æ–∑–¥–∞–Ω–æ –∫–æ–º–º–∏—Ç–æ–≤:</b> ${{ steps.generate_commits.outputs.commit_count }}%0A"
        MESSAGE+="üïí <b>–í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞:</b> $(date +'%H:%M –ú–°–ö')%0A"
        MESSAGE+="üìÖ <b>–î–∞—Ç–∞:</b> $(date +'%d.%m.%Y')%0A"
        MESSAGE+="üë§ <b>–ó–∞–ø—É—â–µ–Ω–æ:</b> ${{ github.actor }}%0A%0A"
        
        # –†–∞–∑–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–µ—Å—Å–∏–π
        case $CURRENT_HOUR in
          "05") MESSAGE+="<i>–û—Ç–ª–∏—á–Ω–æ–µ –Ω–∞—á–∞–ª–æ –¥–Ω—è! –£—Ç—Ä–µ–Ω–Ω–∏–µ –∫–æ–º–º–∏—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã.</i>" ;;
          "08") MESSAGE+="<i>–†–∞–±–æ—á–∏–π –¥–µ–Ω—å –≤ —Ä–∞–∑–≥–∞—Ä–µ! –î–Ω–µ–≤–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≥–æ—Ç–æ–≤—ã.</i>" ;;
          "11") MESSAGE+="<i>–ü–æ—Å–ª–µ–æ–±–µ–¥–µ–Ω–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å! –ö–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω.</i>" ;;
          "14") MESSAGE+="<i>–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è. –í–µ—á–µ—Ä–Ω–∏–µ –∫–æ–º–º–∏—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã.</i>" ;;
          *) MESSAGE+="<i>–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –∫–æ–º–º–∏—Ç–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω.</i>" ;;
        esac
        
        curl -s -X POST \
          "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage" \
          -d chat_id="${TELEGRAM_CHAT_ID}" \
          -d text="${MESSAGE}" \
          -d parse_mode="HTML"
        
        echo "üì± Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –¥–ª—è ${{ steps.generate_commits.outputs.session_name }}"
    
    - name: Send daily summary at evening
      if: success() && github.event.schedule == '0 14 * * *'
      env:
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      run: |
        # –¢–æ–ª—å–∫–æ –¥–ª—è –≤–µ—á–µ—Ä–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞ - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏—Ç–æ–≥–∏ –¥–Ω—è
        MESSAGE="üìä <b>–ò—Ç–æ–≥–∏ –¥–Ω—è –ø–æ –∫–æ–º–º–∏—Ç–∞–º</b>%0A%0A"
        MESSAGE+="üéØ <b>–í—Å–µ–≥–æ —Å–µ—Å—Å–∏–π —Å–µ–≥–æ–¥–Ω—è:</b> 4%0A"
        MESSAGE+="üî¢ <b>–ü—Ä–∏–º–µ—Ä–Ω–æ –∫–æ–º–º–∏—Ç–æ–≤:</b> 8-16%0A"
        MESSAGE+="üìÖ <b>–î–∞—Ç–∞:</b> $(date +'%d.%m.%Y')%0A"
        MESSAGE+="üåÖ <b>–£—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Å—Å–∏—è:</b> 08:00 –ú–°–ö ‚úì%0A"
        MESSAGE+="‚òÄÔ∏è <b>–î–Ω–µ–≤–Ω–∞—è —Å–µ—Å—Å–∏—è:</b> 11:00 –ú–°–ö ‚úì%0A"
        MESSAGE+="üåá <b>–ü–æ—Å–ª–µ–æ–±–µ–¥–µ–Ω–Ω–∞—è —Å–µ—Å—Å–∏—è:</b> 14:00 –ú–°–ö ‚úì%0A"
        MESSAGE+="üåô <b>–í–µ—á–µ—Ä–Ω—è—è —Å–µ—Å—Å–∏—è:</b> 17:00 –ú–°–ö ‚úì%0A%0A"
        MESSAGE+="<i>–†–∞–±–æ—á–∏–π –¥–µ–Ω—å –∑–∞–≤–µ—Ä—à–µ–Ω! –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ GitHub –æ–±–Ω–æ–≤–ª–µ–Ω–∞.</i>"
        
        curl -s -X POST \
          "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage" \
          -d chat_id="${TELEGRAM_CHAT_ID}" \
          -d text="${MESSAGE}" \
          -d parse_mode="HTML"
        
        echo "üìä –ò—Ç–æ–≥–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∑–∞ –¥–µ–Ω—å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ"
    
    - name: Send failure notification
      if: failure()
      env:
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      run: |
        CURRENT_HOUR=$(date -u +%H)
        case $CURRENT_HOUR in
          "05") SESSION="—É—Ç—Ä–µ–Ω–Ω–µ–π" ;;
          "08") SESSION="–¥–Ω–µ–≤–Ω–æ–π" ;;
          "11") SESSION="–ø–æ—Å–ª–µ–æ–±–µ–¥–µ–Ω–Ω–æ–π" ;;
          "14") SESSION="–≤–µ—á–µ—Ä–Ω–µ–π" ;;
          *) SESSION="—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π" ;;
        esac
        
        MESSAGE="‚ùå <b>–û—à–∏–±–∫–∞ –≤ $SESSION —Å–µ—Å—Å–∏–∏ –∫–æ–º–º–∏—Ç–æ–≤</b>%0A%0A"
        MESSAGE+="üïí <b>–í—Ä–µ–º—è:</b> $(date +'%H:%M –ú–°–ö')%0A"
        MESSAGE+="üìÖ <b>–î–∞—Ç–∞:</b> $(date +'%d.%m.%Y')%0A"
        MESSAGE+="üîó <b>–õ–æ–≥–∏:</b> https://github.com/${{ github.repository }}/actions%0A%0A"
        MESSAGE+="<i>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ workflow –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º—ã</i>"
        
        curl -s -X POST \
          "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage" \
          -d chat_id="${TELEGRAM_CHAT_ID}" \
          -d text="${MESSAGE}" \
          -d parse_mode="HTML"